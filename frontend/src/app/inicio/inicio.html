<app-nav-inicio></app-nav-inicio>

<div class="container mt-4">

  <!-- Filtros -->
  <div class="card shadow-sm mb-4">
    <div class="card-body d-flex flex-wrap justify-content-between align-items-center">

      <h5 class="mb-2 mb-md-0" style="color: white">Filtrar por:</h5>

      <div class="btn-group mb-2 mb-md-0" role="group">
        <button class="btn btn-outline-primary" (click)="captarFiltro()">Fecha</button>
        <button class="btn btn-outline-danger" (click)="captarFiltro2()">Likes</button>
      </div>

      <form class="d-flex" (ngSubmit)="getPerfil(usuario)">
        <input
          [(ngModel)]="usuario"
          type="text"
          name="nombre"
          class="form-control me-2"
          placeholder="Buscar usuario..."
        />
        <button type="submit" class="btn btn-success">Buscar</button>
      </form>

    </div>
  </div>

  <!-- Lista de publicaciones -->
  <div class="container mt-4">
    <div class="d-flex flex-column align-items-center gap-4">

      @for (pub of publicaciones; track pub._id) {

        <div class="card shadow-sm w-100" style="max-width: 800px;">
          <div class="card-body">

            <!-- Componente publicaciÃ³n -->
            <app-publicacion [pub]="pub"></app-publicacion>

            <!-- Botonera -->
            <div class="d-flex justify-content-between align-items-center mt-3">

              <!-- Likes -->
              <div>
                @if (!pub.usuariosLikes.includes(usuarioActual._id)) {
                  <button class="btn btn-success btn-sm" (click)="like(pub._id)" appLike>
                    ğŸ‘ Me gusta
                  </button>
                } @else {
                  <button class="btn btn-secondary btn-sm" (click)="dislike(pub._id)" appDislike>
                    ğŸ’” Eliminar me gusta
                  </button>
                }
              </div>

              <!-- Comentar -->
              <div>
                <button class="btn btn-outline-primary btn-sm" (click)="comentarios()">
                  ğŸ’¬ Comentar
                </button>
              </div>

              <!-- Eliminar o ver -->
              <div class="d-flex gap-2">
                @if (usuarioActual.username === pub.usuario || usuarioActual.rol === 'admin') {
                  <button class="btn btn-danger btn-sm" (click)="delete(pub._id, usuarioActual.username)">
                    ğŸ—‘ Eliminar
                  </button>
                }
                <button class="btn btn-outline-dark btn-sm" style="color: white" (click)="publicacionGrande(pub._id)">
                  ğŸ” Ver en grande
                </button>
              </div>

            </div>

            <!-- Campo de comentario -->
            @if (comentarios_activados) {
              <div class="mt-3">
                <form class="d-flex gap-2">
                  <input 
                    [(ngModel)]="texto"
                    name="texto"
                    type="text"
                    placeholder="Escribe un comentario..."
                    required
                    class="form-control"
                  />
                  <button class="btn btn-primary" (click)="comentar(pub._id, texto)">Enviar</button>
                </form>
              </div>
            }

          </div>
        </div>

      }

      <!-- PaginaciÃ³n -->
      <div class="d-flex gap-4 mt-3">
        @if (regresar != 0) {
          <button class="btn btn-warning px-4" (click)="volver()">Volver</button>
        }
        <button class="btn btn-info px-4" (click)="cargarMas()">Siguiente</button>
      </div>

    </div>
  </div>
</div>
