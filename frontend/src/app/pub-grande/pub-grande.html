<app-nav-inicio></app-nav-inicio>

<div class="card shadow p-4 mb-4">
  <div class="card-body">

    <!-- Usuario y fecha -->
    <div class="d-flex justify-content-between align-items-center mb-2">
      <p class="fw-semibold mb-0 text-primary">@{{ pub.usuario }}</p>
      <p class="text-muted small mb-0">{{ pub.fecha }}</p>
    </div>

    <!-- Título y descripción -->
    <h4 class="card-title">{{ pub.titulo }}</h4>
    <p class="card-text text-secondary">{{ pub.descripcion }}</p>

    <!-- Imagen -->
    @if (pub.imagen) {
      <div class="text-center my-3">
        <img
          [src]="pub.imagen"
          class="img-fluid rounded shadow"
          style="max-height: 380px; object-fit: cover;"
        />
      </div>
    }

    <!-- Likes -->
    <div class="mt-3 mb-4">
      <span class="fs-5 text-danger">❤️ {{ pub.likes }}</span>
    </div>

    <hr>

    <!-- Lista de comentarios -->
    <h6 class="text-muted mb-3">Comentarios</h6>

    @for(c of comentarios; track c._id) {
      <div class="p-3 bg-light rounded mb-3">

        <div class="d-flex justify-content-between">
          <strong>@{{ c.usuario }}</strong>
          @if (c.edit) {
            <span class="badge bg-warning text-dark">Editado</span>
          }
        </div>

        <p class="mb-2">{{ c.text }}</p>

        <!-- Zona de edición -->
        @if(edicion_activada && c._id === comeId) {
          <div class="mb-2">
            <input 
              [(ngModel)]="texto_editado"
              name="texto_editado"
              type="text"
              class="form-control mb-2"
              placeholder="{{ c.text }}"
              required
            >

            <button 
              class="btn btn-success btn-sm"
              (click)="editar(c._id, texto_editado, pub._id)">
              Guardar cambios
            </button>
          </div>
        }

        <!-- Botón Editar -->
        @if(usuarioActual.username === c.usuario) {
          <button 
            class="btn btn-outline-primary btn-sm mt-2"
            (click)="activarEdicion(c._id)">
            Editar
          </button>
        }

      </div>
    }
    <button (click)="cargarMas()">Cargar más</button>
  </div>
</div>
